{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - MyTodo{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/todo/todo.css' %}">

{% if user.is_authenticated %}
<section class="user-dashboard">
    <div class="dashboard-container">

        <!-- =================== ToDo List =================== -->
        <div class="todo-section">
            <h2>ToDo List</h2>

            <!-- Qo‘shish formasi -->
            <form method="POST" action="{% url 'home' %}" class="todo-form">
                {% csrf_token %}
                <input type="hidden" name="add_todo" value="1">
                <input type="text" name="title" placeholder="Yangi vazifa..." required>
                <input type="date" name="deadline" class="deadline-input">
                <button type="submit" class="btn-submit" style="font-weight: bold;font-size: 20px;">+</button>
            </form>

            <!-- ToDo ro‘yxati -->
                    {% if todos %}
                    <ul class="todo-list">
                        {% for todo in todos %}
                        <li class="todo-item-wrapper">

            <!-- ToDo ma'lumotlari -->
            <div class="todo-item {{ todo.color_class }}">
                <span class="todo-title">{{ todo.title }}</span>
                {% if todo.deadline %}
                <span class="todo-deadline">
                    {{ todo.deadline|date:"d M, Y" }} - 
                    {% if todo.days_left > 0 %}
                        {{ todo.days_left }} kun qoldi
                    {% elif todo.days_left == 0 %}
                        Bugun!
                    {% else %}
                        Sana tugagan
                    {% endif %}
                </span>
                {% endif %}
            </div>

            <!-- Tugmalar -->
            <div class="todo-buttons">
                <form method="POST" action="{% url 'todo_edit' todo.id %}" class="todo-edit-form">
                    {% csrf_token %}
                    <button type="submit" class="btn-edit">Edit</button>
                </form>

                <form method="POST" action="{% url 'todo_delete' todo.id %}" class="todo-delete-form">
                    {% csrf_token %}
                    <button type="submit" class="btn-delete">Delete</button>
                </form>
            </div>
        </li>

                {% endfor %}
            </ul>
            {% else %}
            <p class="empty-msg">Hozircha vazifangiz yo‘q.</p>
            {% endif %}

            <!-- ToDo Listga qaytish -->
            <a href="{% url 'home' %}" class="btn-submit" style="margin-top: 10px; display: inline-block;font-size: large; text-decoration: none;text-align: center;font-weight: bold;">
                Home
            </a>
        </div>

        <!-- =================== Homework Section =================== -->
        <div class="homework-section">
            <h2>Mening Homework’larim</h2>
            {% if homework %}
            <ul class="homework-list">
                {% for hw in homework %}
                <li class="homework-item">
                    <span class="homework-subject">{{ hw.subject }}</span>
                    <span class="homework-hours">{{ hw.hours_spent }} soat</span>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="empty-msg">Hozircha homework yo‘q.</p>
            {% endif %}
        </div>

    </div>
</section>
{% endif %}
{% endblock %}
